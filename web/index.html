<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shirushi - Nostr Protocol Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@400;500;600&family=Geist:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <button id="mobile-menu-btn" class="mobile-menu-btn" aria-label="Toggle navigation menu" aria-expanded="false">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        <div class="logo">
            <span class="logo-text">Shirushi</span>
            <span class="logo-subtitle">Nostr Protocol Explorer</span>
        </div>
        <div class="header-status-group">
            <div class="status" id="extension-status" title="NIP-07 browser extension status">
                <span id="extension-status-dot" class="status-dot"></span>
                <span id="extension-status-text">Checking...</span>
            </div>
            <div class="status">
                <span id="connection-status" class="status-dot disconnected"></span>
                <span id="connection-text">Connecting...</span>
            </div>
        </div>
    </header>

    <div id="mobile-nav-overlay" class="mobile-nav-overlay"></div>
    <nav class="tabs" id="main-nav">
        <button class="tab active" data-tab="relays">Relays</button>
        <button class="tab" data-tab="explorer">Explorer</button>
        <button class="tab" data-tab="events">Events</button>
        <button class="tab" data-tab="publish">Publish</button>
        <button class="tab" data-tab="testing">Testing</button>
        <button class="tab" data-tab="keys">Keys</button>
        <button class="tab" data-tab="console">Console</button>
        <button class="tab" data-tab="monitoring">Monitoring</button>
    </nav>

    <main id="content">
        <!-- Relays Tab -->
        <section id="relays-tab" class="tab-content active">
            <div class="panel">
                <h2>Connected Relays</h2>
                <!-- Skeleton for Relay Cards -->
                <div id="relay-list-skeleton" class="skeleton-container skeleton-grid skeleton-grid-relays">
                    <div class="skeleton-relay-card">
                        <div class="skeleton-relay-header">
                            <div class="skeleton skeleton-relay-url"></div>
                            <div class="skeleton skeleton-relay-status"></div>
                        </div>
                        <div class="skeleton-relay-stats">
                            <div class="skeleton skeleton-relay-stat"></div>
                            <div class="skeleton skeleton-relay-stat"></div>
                        </div>
                        <div class="skeleton-relay-actions">
                            <div class="skeleton skeleton-relay-btn"></div>
                            <div class="skeleton skeleton-relay-btn"></div>
                        </div>
                    </div>
                    <div class="skeleton-relay-card">
                        <div class="skeleton-relay-header">
                            <div class="skeleton skeleton-relay-url"></div>
                            <div class="skeleton skeleton-relay-status"></div>
                        </div>
                        <div class="skeleton-relay-stats">
                            <div class="skeleton skeleton-relay-stat"></div>
                            <div class="skeleton skeleton-relay-stat"></div>
                        </div>
                        <div class="skeleton-relay-actions">
                            <div class="skeleton skeleton-relay-btn"></div>
                            <div class="skeleton skeleton-relay-btn"></div>
                        </div>
                    </div>
                    <div class="skeleton-relay-card">
                        <div class="skeleton-relay-header">
                            <div class="skeleton skeleton-relay-url"></div>
                            <div class="skeleton skeleton-relay-status"></div>
                        </div>
                        <div class="skeleton-relay-stats">
                            <div class="skeleton skeleton-relay-stat"></div>
                            <div class="skeleton skeleton-relay-stat"></div>
                        </div>
                        <div class="skeleton-relay-actions">
                            <div class="skeleton skeleton-relay-btn"></div>
                            <div class="skeleton skeleton-relay-btn"></div>
                        </div>
                    </div>
                </div>
                <div id="relay-list" class="relay-grid"></div>
            </div>
            <div class="panel">
                <h3>Add Relay</h3>
                <div class="input-group">
                    <input type="text" id="relay-url" placeholder="wss://relay.example.com">
                    <button id="add-relay-btn" class="btn primary">Connect</button>
                </div>
                <div class="presets">
                    <span>Presets:</span>
                    <button class="btn small" data-preset="popular">Popular</button>
                    <button class="btn small" data-preset="fast">Fast</button>
                    <button class="btn small" data-preset="dvms">DVMs</button>
                    <button class="btn small" data-preset="privacy">Privacy</button>
                </div>
            </div>
        </section>

        <!-- Explorer Tab -->
        <section id="explorer-tab" class="tab-content">
            <div class="panel">
                <h2>Profile Explorer</h2>
                <div class="input-group">
                    <input type="text" id="profile-search" placeholder="npub1... or user@domain.com (NIP-05)">
                    <button id="explore-profile-btn" class="btn primary">Explore</button>
                </div>
                <p class="hint">Enter an npub public key or NIP-05 identifier to explore a Nostr profile</p>
            </div>

            <!-- Skeleton for Profile Card -->
            <div id="profile-card-skeleton" class="skeleton-container skeleton-profile-card hidden">
                <div class="skeleton skeleton-profile-banner"></div>
                <div class="skeleton-profile-header">
                    <div class="skeleton skeleton-avatar skeleton-profile-avatar"></div>
                    <div class="skeleton-profile-info">
                        <div class="skeleton skeleton-line skeleton-profile-name"></div>
                        <div class="skeleton skeleton-line skeleton-profile-username"></div>
                        <div class="skeleton skeleton-line skeleton-profile-pubkey"></div>
                    </div>
                </div>
                <div class="skeleton-profile-body">
                    <div class="skeleton-profile-about">
                        <div class="skeleton skeleton-line w-full"></div>
                        <div class="skeleton skeleton-line w-3\/4"></div>
                        <div class="skeleton skeleton-line w-1\/2"></div>
                    </div>
                    <div class="skeleton-profile-stats">
                        <div class="skeleton-profile-stat">
                            <div class="skeleton skeleton-line skeleton-profile-stat-value"></div>
                            <div class="skeleton skeleton-line skeleton-profile-stat-label"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="profile-card" class="profile-card hidden">
                <div id="profile-banner" class="profile-banner"></div>
                <div class="profile-header">
                    <div id="profile-avatar" class="profile-avatar"></div>
                    <div class="profile-info">
                        <div class="profile-name-row">
                            <span id="profile-display-name" class="profile-display-name"></span>
                            <span id="profile-nip05-badge" class="nip05-badge hidden" title="NIP-05 DNS Identity">
                                <span class="nip05-icon" title="">‚úì</span>
                                <span id="profile-nip05"></span>
                            </span>
                        </div>
                        <span id="profile-name" class="profile-username"></span>
                        <span id="profile-pubkey" class="profile-pubkey"></span>
                    </div>
                    <div class="profile-actions">
                        <button class="btn small" data-copy="profile-pubkey">Copy npub</button>
                    </div>
                </div>
                <div class="profile-body">
                    <p id="profile-about" class="profile-about"></p>
                    <div class="profile-links">
                        <a id="profile-website" class="profile-link hidden" target="_blank" rel="noopener noreferrer">
                            <span class="link-icon">üåê</span>
                            <span class="link-text"></span>
                        </a>
                        <span id="profile-lightning" class="profile-link hidden">
                            <span class="link-icon">‚ö°</span>
                            <span class="link-text"></span>
                        </span>
                    </div>
                    <div class="profile-stats">
                        <div class="stat">
                            <span id="profile-follow-count" class="stat-value">0</span>
                            <span class="stat-label">Following</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="profile-content" class="profile-content hidden">
                <div class="profile-tabs">
                    <button class="profile-tab active" data-profile-tab="notes">Notes</button>
                    <button class="profile-tab" data-profile-tab="following">Following</button>
                    <button class="profile-tab" data-profile-tab="zaps">Zaps</button>
                </div>

                <div id="profile-notes-tab" class="profile-tab-content active">
                    <!-- Skeleton for Notes List -->
                    <div id="profile-notes-skeleton" class="skeleton-container skeleton-list">
                        <div class="skeleton-note-card">
                            <div class="skeleton-note-content">
                                <div class="skeleton skeleton-line w-full"></div>
                                <div class="skeleton skeleton-line w-3\/4"></div>
                                <div class="skeleton skeleton-line w-1\/2"></div>
                            </div>
                            <div class="skeleton-note-meta">
                                <div class="skeleton skeleton-line skeleton-note-time"></div>
                                <div class="skeleton skeleton-line skeleton-note-id"></div>
                            </div>
                        </div>
                        <div class="skeleton-note-card">
                            <div class="skeleton-note-content">
                                <div class="skeleton skeleton-line w-full"></div>
                                <div class="skeleton skeleton-line w-2\/3"></div>
                            </div>
                            <div class="skeleton-note-meta">
                                <div class="skeleton skeleton-line skeleton-note-time"></div>
                                <div class="skeleton skeleton-line skeleton-note-id"></div>
                            </div>
                        </div>
                        <div class="skeleton-note-card">
                            <div class="skeleton-note-content">
                                <div class="skeleton skeleton-line w-full"></div>
                                <div class="skeleton skeleton-line w-full"></div>
                                <div class="skeleton skeleton-line w-1\/3"></div>
                            </div>
                            <div class="skeleton-note-meta">
                                <div class="skeleton skeleton-line skeleton-note-time"></div>
                                <div class="skeleton skeleton-line skeleton-note-id"></div>
                            </div>
                        </div>
                    </div>
                    <div id="profile-notes-list" class="profile-notes-list">
                        <p class="hint">Loading notes...</p>
                    </div>
                </div>

                <div id="profile-following-tab" class="profile-tab-content">
                    <!-- Skeleton for Following List -->
                    <div id="profile-following-skeleton" class="skeleton-container skeleton-list skeleton-list-sm hidden">
                        <div class="skeleton-follow-card">
                            <div class="skeleton skeleton-avatar skeleton-follow-avatar"></div>
                            <div class="skeleton-follow-info">
                                <div class="skeleton skeleton-line skeleton-follow-name"></div>
                                <div class="skeleton skeleton-line skeleton-follow-pubkey"></div>
                            </div>
                            <div class="skeleton skeleton-line skeleton-follow-relay"></div>
                        </div>
                        <div class="skeleton-follow-card">
                            <div class="skeleton skeleton-avatar skeleton-follow-avatar"></div>
                            <div class="skeleton-follow-info">
                                <div class="skeleton skeleton-line skeleton-follow-name"></div>
                                <div class="skeleton skeleton-line skeleton-follow-pubkey"></div>
                            </div>
                            <div class="skeleton skeleton-line skeleton-follow-relay"></div>
                        </div>
                        <div class="skeleton-follow-card">
                            <div class="skeleton skeleton-avatar skeleton-follow-avatar"></div>
                            <div class="skeleton-follow-info">
                                <div class="skeleton skeleton-line skeleton-follow-name"></div>
                                <div class="skeleton skeleton-line skeleton-follow-pubkey"></div>
                            </div>
                            <div class="skeleton skeleton-line skeleton-follow-relay"></div>
                        </div>
                        <div class="skeleton-follow-card">
                            <div class="skeleton skeleton-avatar skeleton-follow-avatar"></div>
                            <div class="skeleton-follow-info">
                                <div class="skeleton skeleton-line skeleton-follow-name"></div>
                                <div class="skeleton skeleton-line skeleton-follow-pubkey"></div>
                            </div>
                            <div class="skeleton skeleton-line skeleton-follow-relay"></div>
                        </div>
                    </div>
                    <div id="profile-following-list" class="profile-following-list">
                        <p class="hint">Loading following list...</p>
                    </div>
                </div>

                <div id="profile-zaps-tab" class="profile-tab-content">
                    <div class="zap-stats-summary panel" id="zap-stats-summary">
                        <div class="zap-stat">
                            <span id="zap-total-count" class="zap-stat-value">0</span>
                            <span class="zap-stat-label">Total Zaps</span>
                        </div>
                        <div class="zap-stat">
                            <span id="zap-total-sats" class="zap-stat-value">0</span>
                            <span class="zap-stat-label">Total Sats</span>
                        </div>
                        <div class="zap-stat">
                            <span id="zap-avg-sats" class="zap-stat-value">0</span>
                            <span class="zap-stat-label">Avg Sats</span>
                        </div>
                        <div class="zap-stat">
                            <span id="zap-top-zap" class="zap-stat-value">0</span>
                            <span class="zap-stat-label">Top Zap</span>
                        </div>
                    </div>
                    <!-- Skeleton for Zaps List -->
                    <div id="profile-zaps-skeleton" class="skeleton-container skeleton-list skeleton-list-sm hidden">
                        <div class="skeleton-zap-card">
                            <div class="skeleton skeleton-line skeleton-zap-amount"></div>
                            <div class="skeleton skeleton-line skeleton-zap-sender"></div>
                            <div class="skeleton skeleton-line skeleton-zap-time"></div>
                        </div>
                        <div class="skeleton-zap-card">
                            <div class="skeleton skeleton-line skeleton-zap-amount"></div>
                            <div class="skeleton skeleton-line skeleton-zap-sender"></div>
                            <div class="skeleton skeleton-line skeleton-zap-time"></div>
                        </div>
                        <div class="skeleton-zap-card">
                            <div class="skeleton skeleton-line skeleton-zap-amount"></div>
                            <div class="skeleton skeleton-line skeleton-zap-sender"></div>
                            <div class="skeleton skeleton-line skeleton-zap-time"></div>
                        </div>
                    </div>
                    <div id="profile-zaps-list" class="profile-zaps-list">
                        <p class="hint">Loading zap history...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Events Tab -->
        <section id="events-tab" class="tab-content">
            <div class="panel">
                <h2>Lookup Event</h2>
                <p class="hint">Fetch an event by its ID (64-character hex or note1... / nevent1... format)</p>
                <div class="lookup-section">
                    <div class="lookup-input-row">
                        <input type="text" id="event-lookup-input" class="form-input" placeholder="Event ID (hex or note1... / nevent1...)">
                        <button id="event-lookup-btn" class="btn primary">Lookup</button>
                        <button id="fetch-all-relays-btn" class="btn">Fetch from All Relays</button>
                        <button id="clear-lookup-btn" class="btn">Clear</button>
                    </div>
                    <div id="lookup-result" class="lookup-result hidden">
                        <div class="lookup-result-content"></div>
                    </div>
                    <div id="all-relays-result" class="all-relays-result hidden">
                        <div class="all-relays-result-content"></div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <h2>Verify Event Signature</h2>
                <p class="hint">Paste a signed Nostr event JSON to verify its cryptographic signature</p>
                <div class="verify-section">
                    <textarea id="verify-event-input" class="form-textarea verify-textarea" rows="8" placeholder='{"id":"...","pubkey":"...","created_at":...,"kind":...,"tags":[...],"content":"...","sig":"..."}'></textarea>
                    <div class="verify-actions">
                        <button id="verify-event-btn" class="btn primary">Verify Signature</button>
                        <button id="clear-verify-btn" class="btn">Clear</button>
                        <button id="paste-verify-btn" class="btn small">Paste from Clipboard</button>
                    </div>
                    <div id="verify-result" class="verify-result hidden">
                        <div class="verify-result-content"></div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <h2>Compare Events (Diff)</h2>
                <p class="hint">Paste two Nostr events to compare their differences</p>
                <div class="diff-section">
                    <div class="diff-inputs">
                        <div class="diff-input-group">
                            <label for="diff-event-a">Event A</label>
                            <textarea id="diff-event-a" class="form-textarea diff-textarea" rows="6" placeholder='{"id":"...","pubkey":"...","created_at":...,"kind":...,"tags":[...],"content":"...","sig":"..."}'></textarea>
                        </div>
                        <div class="diff-input-group">
                            <label for="diff-event-b">Event B</label>
                            <textarea id="diff-event-b" class="form-textarea diff-textarea" rows="6" placeholder='{"id":"...","pubkey":"...","created_at":...,"kind":...,"tags":[...],"content":"...","sig":"..."}'></textarea>
                        </div>
                    </div>
                    <div class="diff-actions">
                        <button id="compare-events-btn" class="btn primary">Compare Events</button>
                        <button id="swap-events-btn" class="btn">Swap A/B</button>
                        <button id="clear-diff-btn" class="btn">Clear</button>
                    </div>
                    <div id="diff-result" class="diff-result hidden">
                        <div class="diff-result-content"></div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <h2>Batch Query</h2>
                <p class="hint">Fetch multiple events by their IDs at once. Enter one ID per line (hex, note1..., or nevent1... format)</p>
                <div class="batch-query-section">
                    <textarea id="batch-query-input" class="form-textarea batch-query-textarea" rows="6" placeholder="Enter event IDs, one per line:
abc123...def456 (64-char hex)
note1abc...
nevent1xyz..."></textarea>
                    <div class="batch-query-actions">
                        <button id="batch-query-btn" class="btn primary">Fetch Events</button>
                        <button id="clear-batch-btn" class="btn">Clear</button>
                        <span class="batch-query-count">
                            <span id="batch-id-count">0</span> event IDs
                        </span>
                    </div>
                    <div id="batch-query-result" class="batch-query-result hidden">
                        <div class="batch-query-summary">
                            <span class="batch-found"><span id="batch-found-count">0</span> found</span>
                            <span class="batch-missing"><span id="batch-missing-count">0</span> missing</span>
                            <span class="batch-time"><span id="batch-query-time">0</span>ms</span>
                        </div>
                        <div class="batch-query-results" id="batch-query-results"></div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <h2>Event Stream</h2>
                <div class="query-builder">
                    <div class="query-builder-row">
                        <div class="query-builder-field">
                            <label for="filter-kinds">Kinds</label>
                            <input type="text" id="filter-kinds" class="form-input" placeholder="1, 7, 30023 (comma-separated)">
                            <span class="field-hint">Event kinds to filter (e.g., 1 for notes, 0 for profiles)</span>
                        </div>
                        <div class="query-builder-field">
                            <label for="filter-authors">Authors</label>
                            <input type="text" id="filter-authors" class="form-input" placeholder="npub1... or hex (comma-separated)">
                            <span class="field-hint">Public keys (npub or hex format)</span>
                        </div>
                    </div>
                    <div class="query-builder-row">
                        <div class="query-builder-field">
                            <label for="filter-tags">Tags</label>
                            <input type="text" id="filter-tags" class="form-input" placeholder="#e:abc..., #p:def..., #t:nostr">
                            <span class="field-hint">Tag filters: #tagname:value (e.g., #t:nostr, #e:eventid)</span>
                        </div>
                        <div class="query-builder-field query-builder-field-limit">
                            <label for="filter-limit">Limit</label>
                            <input type="number" id="filter-limit" class="form-input" placeholder="20" min="1" max="500" value="20">
                            <span class="field-hint">Max events (1-500)</span>
                        </div>
                    </div>
                    <div class="query-builder-row">
                        <div class="query-builder-field">
                            <label for="filter-since">Since</label>
                            <input type="datetime-local" id="filter-since" class="form-input">
                            <span class="field-hint">Events created after this time</span>
                        </div>
                        <div class="query-builder-field">
                            <label for="filter-until">Until</label>
                            <input type="datetime-local" id="filter-until" class="form-input">
                            <span class="field-hint">Events created before this time</span>
                        </div>
                    </div>
                    <div class="query-builder-row">
                        <div class="query-builder-field query-builder-field-full">
                            <label>Query Relays <span id="events-relay-selection-count" class="relay-selection-count"></span></label>
                            <div class="relay-selector-controls">
                                <button type="button" id="events-select-all-relays" class="btn small">Select All</button>
                                <button type="button" id="events-select-none-relays" class="btn small">Select None</button>
                                <button type="button" id="events-select-connected-relays" class="btn small">Connected Only</button>
                            </div>
                            <div id="events-relay-list" class="relay-checkbox-list relay-checkbox-list-compact">
                                <p class="hint">Loading relays...</p>
                            </div>
                        </div>
                    </div>
                    <div class="query-builder-actions">
                        <button id="apply-filter-btn" class="btn primary">Query Events</button>
                        <button id="clear-filter-btn" class="btn">Clear Filters</button>
                        <label class="query-builder-checkbox">
                            <input type="checkbox" id="show-timing">
                            Show fetch timing
                        </label>
                    </div>
                </div>
                <div class="event-controls">
                    <label>
                        <input type="checkbox" id="auto-scroll" checked>
                        Auto-scroll
                    </label>
                    <button id="clear-events-btn" class="btn small">Clear Events</button>
                </div>
            </div>
            <div id="fetch-timing-panel" class="fetch-timing-panel hidden">
                <div class="fetch-timing-header">
                    <span class="fetch-timing-title">Fetch Timing per Relay</span>
                    <span class="fetch-timing-total"></span>
                </div>
                <div class="fetch-timing-content"></div>
            </div>
            <div id="event-list" class="event-stream">
                <p class="hint">Waiting for events from connected relays...</p>
            </div>
        </section>

        <!-- Publish Tab -->
        <section id="publish-tab" class="tab-content">
            <div class="publish-layout">
                <div class="panel publish-form-panel">
                    <h2>Publish Event</h2>
                    <p class="hint">Create and publish events to connected relays as yourself</p>

                    <div class="publish-form">
                        <div class="form-group">
                            <label for="publish-kind">Event Kind</label>
                            <select id="publish-kind" class="form-select">
                                <option value="1">1 - Short Text Note</option>
                                <option value="0">0 - Metadata</option>
                                <option value="3">3 - Contacts</option>
                                <option value="4">4 - Encrypted Direct Message</option>
                                <option value="7">7 - Reaction</option>
                                <option value="custom">Custom Kind...</option>
                            </select>
                            <input type="number" id="publish-custom-kind" class="form-input hidden" placeholder="Enter custom kind number" min="0">
                        </div>

                        <div class="form-group">
                            <label for="publish-content">Content</label>
                            <textarea id="publish-content" class="form-textarea" rows="4" placeholder="Enter your message..."></textarea>
                            <span class="char-count"><span id="content-char-count">0</span> characters</span>
                        </div>

                        <div class="form-group">
                            <label>Tags <span class="optional">(optional)</span></label>
                            <div id="tag-builder" class="tag-builder">
                                <div id="tag-builder-rows" class="tag-builder-rows">
                                    <!-- Tag rows will be added here dynamically -->
                                </div>
                                <button id="add-tag-row-btn" class="btn small tag-builder-add">+ Add Tag</button>
                            </div>
                            <p class="hint">Common tags: p (pubkey), e (event), t (hashtag). Use + to add more values to a tag.</p>
                        </div>

                        <div class="form-group">
                            <label>Signing Method</label>
                            <div class="signing-options">
                                <label class="radio-option">
                                    <input type="radio" name="signing-method" value="extension" id="sign-extension" checked>
                                    <span class="radio-label">
                                        <span class="radio-title">Browser Extension (NIP-07)</span>
                                        <span class="radio-desc" id="extension-sign-status">Checking...</span>
                                    </span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="signing-method" value="nsec" id="sign-nsec">
                                    <span class="radio-label">
                                        <span class="radio-title">Private Key (nsec)</span>
                                        <span class="radio-desc">Enter your nsec to sign</span>
                                    </span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group hidden" id="nsec-input-group">
                            <label for="publish-nsec">Private Key (nsec)</label>
                            <div class="key-input-wrapper">
                                <input type="password" id="publish-nsec" class="form-input" placeholder="nsec1...">
                                <button type="button" id="toggle-publish-nsec" class="btn small">Show</button>
                            </div>
                            <p class="hint warning">Your private key is never stored or sent to any server when using extension signing</p>
                        </div>

                        <div class="form-group">
                            <label>Target Relays <span id="relay-selection-count" class="relay-selection-count"></span></label>
                            <div class="relay-selector-controls">
                                <button type="button" id="select-all-relays" class="btn small">Select All</button>
                                <button type="button" id="select-none-relays" class="btn small">Select None</button>
                                <button type="button" id="select-connected-relays" class="btn small">Connected Only</button>
                            </div>
                            <div id="publish-relay-list" class="relay-checkbox-list">
                                <p class="hint">Loading relays...</p>
                            </div>
                        </div>

                        <div class="publish-actions">
                            <button id="preview-event-btn" class="btn">Preview Event</button>
                            <button id="sign-only-btn" class="btn">Sign Only</button>
                            <button id="sign-publish-btn" class="btn primary">Sign & Publish</button>
                        </div>
                    </div>
                </div>

                <div class="panel publish-preview-panel">
                    <h3>Event Preview</h3>
                    <div id="event-preview" class="event-preview">
                        <p class="hint">Fill out the form to preview your event</p>
                    </div>

                    <h3>Signed Event</h3>
                    <div id="signed-event-preview" class="signed-event-preview">
                        <p class="hint">Click "Sign Only" to sign and view the complete event</p>
                    </div>

                    <h3>Publish History</h3>
                    <div id="publish-history" class="publish-history">
                        <p class="hint">No events published yet</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testing Tab -->
        <section id="testing-tab" class="tab-content">
            <div class="testing-layout">
                <div class="nip-list panel">
                    <h2>NIP Tests</h2>
                    <div id="nip-test-list"></div>
                </div>
                <div class="test-detail panel">
                    <div id="test-form">
                        <p class="hint">Select a NIP from the list to run tests</p>
                    </div>
                    <div id="test-results"></div>
                </div>
                <div class="test-history panel">
                    <div class="test-history-header">
                        <h2>Test History</h2>
                        <button id="clear-history-btn" class="btn small" title="Clear all history">Clear</button>
                    </div>
                    <div id="test-history-list">
                        <p class="hint">No test history yet</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Keys Tab -->
        <section id="keys-tab" class="tab-content">
            <div class="panel">
                <h2>Generate Keypair</h2>
                <button id="generate-key-btn" class="btn primary">Generate New Keys</button>
                <div id="keypair-result" class="keypair-display hidden">
                    <div class="key-row">
                        <label>Private Key (nsec):</label>
                        <div class="key-value">
                            <input type="password" id="nsec-value" readonly>
                            <button class="btn small" data-copy="nsec-value">Copy</button>
                            <button class="btn small" id="toggle-nsec">Show</button>
                        </div>
                    </div>
                    <div class="key-row">
                        <label>Public Key (npub):</label>
                        <div class="key-value">
                            <input type="text" id="npub-value" readonly>
                            <button class="btn small" data-copy="npub-value">Copy</button>
                        </div>
                    </div>
                    <div class="key-row">
                        <label>Hex Public Key:</label>
                        <div class="key-value">
                            <input type="text" id="hex-pubkey-value" readonly>
                            <button class="btn small" data-copy="hex-pubkey-value">Copy</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel">
                <h2>Encode / Decode NIP-19</h2>
                <div class="input-group">
                    <input type="text" id="nip19-input" placeholder="npub1..., nsec1..., note1..., or hex">
                    <button id="decode-btn" class="btn">Decode</button>
                </div>
                <div class="encode-options">
                    <span>Encode as:</span>
                    <button class="btn small" data-encode="npub">npub</button>
                    <button class="btn small" data-encode="nsec">nsec</button>
                    <button class="btn small" data-encode="note">note</button>
                </div>
                <div id="nip19-result" class="result-box hidden"></div>
            </div>
        </section>

        <!-- Console Tab -->
        <section id="console-tab" class="tab-content">
            <div class="panel">
                <h2>nak Console</h2>
                <p class="hint">Run nak commands directly</p>
                <div class="console-input">
                    <span class="prompt">$ nak</span>
                    <input type="text" id="nak-command" placeholder="key generate">
                    <button id="run-nak-btn" class="btn primary">Run</button>
                </div>
            </div>
            <div class="panel command-reference-panel">
                <button class="command-reference-toggle" id="command-reference-toggle" aria-expanded="false" aria-controls="command-reference-content">
                    <span class="command-reference-toggle-icon">&#9654;</span>
                    <span class="command-reference-toggle-label">Command Reference</span>
                </button>
                <div class="command-reference-content" id="command-reference-content" hidden>
                    <div class="command-reference-section">
                        <h4>Key Management</h4>
                        <div class="command-item" data-command="key generate">
                            <code class="command-code">key generate</code>
                            <span class="command-desc">Generate a new keypair (nsec + npub)</span>
                        </div>
                        <div class="command-item" data-command="key public">
                            <code class="command-code">key public</code>
                            <span class="command-desc">Derive public key from private key (requires stdin)</span>
                        </div>
                        <div class="command-item" data-command="key encrypt">
                            <code class="command-code">key encrypt</code>
                            <span class="command-desc">Encrypt private key with password (NIP-49)</span>
                        </div>
                        <div class="command-item" data-command="key decrypt">
                            <code class="command-code">key decrypt</code>
                            <span class="command-desc">Decrypt encrypted private key (NIP-49)</span>
                        </div>
                    </div>
                    <div class="command-reference-section">
                        <h4>Encoding/Decoding</h4>
                        <div class="command-item" data-command="decode npub1...">
                            <code class="command-code">decode &lt;bech32&gt;</code>
                            <span class="command-desc">Decode npub, nsec, note, nevent, nprofile, naddr</span>
                        </div>
                        <div class="command-item" data-command="encode npub <hex>">
                            <code class="command-code">encode npub &lt;hex&gt;</code>
                            <span class="command-desc">Encode hex pubkey to npub format</span>
                        </div>
                        <div class="command-item" data-command="encode nsec <hex>">
                            <code class="command-code">encode nsec &lt;hex&gt;</code>
                            <span class="command-desc">Encode hex privkey to nsec format</span>
                        </div>
                        <div class="command-item" data-command="encode note <hex>">
                            <code class="command-code">encode note &lt;hex&gt;</code>
                            <span class="command-desc">Encode event ID to note format</span>
                        </div>
                        <div class="command-item" data-command="encode nevent <hex>">
                            <code class="command-code">encode nevent &lt;hex&gt;</code>
                            <span class="command-desc">Encode event ID to nevent with relay hints</span>
                        </div>
                        <div class="command-item" data-command="encode nprofile <hex>">
                            <code class="command-code">encode nprofile &lt;hex&gt;</code>
                            <span class="command-desc">Encode pubkey to nprofile with relay hints</span>
                        </div>
                    </div>
                    <div class="command-reference-section">
                        <h4>Event Operations</h4>
                        <div class="command-item" data-command="event --content 'Hello Nostr!'">
                            <code class="command-code">event --content &lt;text&gt;</code>
                            <span class="command-desc">Create unsigned kind 1 text note</span>
                        </div>
                        <div class="command-item" data-command="event --kind 0 --content '{\"name\":\"test\"}'">
                            <code class="command-code">event --kind &lt;n&gt;</code>
                            <span class="command-desc">Create event with specific kind</span>
                        </div>
                        <div class="command-item" data-command="event --kind 1 -t t=nostr --content 'Tagged post'">
                            <code class="command-code">event -t &lt;tag&gt;</code>
                            <span class="command-desc">Create event with tags (e.g., -t t=nostr)</span>
                        </div>
                        <div class="command-item" data-command="event --kind 7 --content + -e <event_id>">
                            <code class="command-code">event -e &lt;id&gt;</code>
                            <span class="command-desc">Create event referencing another event</span>
                        </div>
                        <div class="command-item" data-command="verify">
                            <code class="command-code">verify</code>
                            <span class="command-desc">Verify event signature (requires stdin)</span>
                        </div>
                    </div>
                    <div class="command-reference-section">
                        <h4>Relay Queries</h4>
                        <div class="command-item" data-command="req -k 1 -l 5 wss://relay.damus.io">
                            <code class="command-code">req -k &lt;kind&gt; -l &lt;limit&gt;</code>
                            <span class="command-desc">Query events by kind with limit</span>
                        </div>
                        <div class="command-item" data-command="req -a <pubkey> -l 10 wss://relay.damus.io">
                            <code class="command-code">req -a &lt;pubkey&gt;</code>
                            <span class="command-desc">Query events by author pubkey</span>
                        </div>
                        <div class="command-item" data-command="req -e <event_id> wss://relay.damus.io">
                            <code class="command-code">req -e &lt;id&gt;</code>
                            <span class="command-desc">Query event by ID</span>
                        </div>
                        <div class="command-item" data-command="req -t t=nostr -l 10 wss://relay.damus.io">
                            <code class="command-code">req -t &lt;tag&gt;</code>
                            <span class="command-desc">Query events by tag (e.g., -t t=nostr)</span>
                        </div>
                        <div class="command-item" data-command="req -k 0 -a <pubkey> wss://relay.damus.io">
                            <code class="command-code">req -k 0 -a &lt;pubkey&gt;</code>
                            <span class="command-desc">Get profile metadata (kind 0)</span>
                        </div>
                        <div class="command-item" data-command="req -k 3 -a <pubkey> wss://relay.damus.io">
                            <code class="command-code">req -k 3 -a &lt;pubkey&gt;</code>
                            <span class="command-desc">Get follow list (kind 3)</span>
                        </div>
                    </div>
                    <div class="command-reference-section">
                        <h4>Fetch &amp; Publish</h4>
                        <div class="command-item" data-command="fetch nevent1...">
                            <code class="command-code">fetch &lt;nevent|nprofile|naddr&gt;</code>
                            <span class="command-desc">Fetch event by bech32 identifier</span>
                        </div>
                        <div class="command-item" data-command="fetch note1... --relay wss://relay.damus.io">
                            <code class="command-code">fetch --relay &lt;url&gt;</code>
                            <span class="command-desc">Fetch from specific relay</span>
                        </div>
                    </div>
                    <div class="command-reference-section">
                        <h4>NIP-05 &amp; DNS</h4>
                        <div class="command-item" data-command="nip05 user@domain.com">
                            <code class="command-code">nip05 &lt;identifier&gt;</code>
                            <span class="command-desc">Resolve NIP-05 identifier to pubkey</span>
                        </div>
                    </div>
                    <div class="command-reference-section">
                        <h4>Utility</h4>
                        <div class="command-item" data-command="--help">
                            <code class="command-code">--help</code>
                            <span class="command-desc">Show all available commands</span>
                        </div>
                        <div class="command-item" data-command="--version">
                            <code class="command-code">--version</code>
                            <span class="command-desc">Show nak version</span>
                        </div>
                        <div class="command-item" data-command="bunker">
                            <code class="command-code">bunker</code>
                            <span class="command-desc">NIP-46 remote signer operations</span>
                        </div>
                        <div class="command-item" data-command="relay wss://relay.damus.io">
                            <code class="command-code">relay &lt;url&gt;</code>
                            <span class="command-desc">Get relay information document</span>
                        </div>
                    </div>
                    <div class="command-reference-footer">
                        <a href="https://github.com/fiatjaf/nak" target="_blank" rel="noopener noreferrer" class="docs-link">
                            View full nak documentation ‚Üí
                        </a>
                    </div>
                </div>
            </div>
            <div class="panel console-output">
                <div class="console-output-header">
                    <h3>Output</h3>
                    <button id="copy-nak-output" class="btn small copy-btn" onclick="app.copyNakOutput()" disabled>Copy Output</button>
                </div>
                <pre id="nak-output"></pre>
            </div>
            <div class="panel">
                <h3>History</h3>
                <div id="command-history"></div>
            </div>
        </section>

        <!-- Monitoring Tab -->
        <section id="monitoring-tab" class="tab-content">
            <div class="monitoring-header panel">
                <h2>Relay Network Health</h2>
                <div class="monitoring-summary">
                    <div class="monitoring-stat">
                        <span id="monitoring-connected" class="monitoring-stat-value">0</span>
                        <span class="monitoring-stat-label">Connected</span>
                    </div>
                    <div class="monitoring-stat">
                        <span id="monitoring-total" class="monitoring-stat-value">0</span>
                        <span class="monitoring-stat-label">Total Relays</span>
                    </div>
                    <div class="monitoring-stat">
                        <span id="monitoring-total-events" class="monitoring-stat-value">0</span>
                        <span class="monitoring-stat-label">Total Events</span>
                    </div>
                </div>
            </div>

            <div class="monitoring-charts">
                <div class="panel chart-panel">
                    <h3>Latency Distribution</h3>
                    <div class="chart-container">
                        <canvas id="latency-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>Relay Health</h3>
                <!-- Skeleton for Relay Health Cards -->
                <div id="relay-health-skeleton" class="skeleton-container skeleton-grid skeleton-grid-health">
                    <div class="skeleton-health-card">
                        <div class="skeleton-health-header">
                            <div class="skeleton skeleton-line skeleton-health-url"></div>
                            <div class="skeleton-health-score">
                                <div class="skeleton skeleton-line skeleton-health-score-value"></div>
                                <div class="skeleton skeleton-line skeleton-health-score-bar"></div>
                            </div>
                        </div>
                        <div class="skeleton-health-metrics">
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                        </div>
                    </div>
                    <div class="skeleton-health-card">
                        <div class="skeleton-health-header">
                            <div class="skeleton skeleton-line skeleton-health-url"></div>
                            <div class="skeleton-health-score">
                                <div class="skeleton skeleton-line skeleton-health-score-value"></div>
                                <div class="skeleton skeleton-line skeleton-health-score-bar"></div>
                            </div>
                        </div>
                        <div class="skeleton-health-metrics">
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                        </div>
                    </div>
                    <div class="skeleton-health-card">
                        <div class="skeleton-health-header">
                            <div class="skeleton skeleton-line skeleton-health-url"></div>
                            <div class="skeleton-health-score">
                                <div class="skeleton skeleton-line skeleton-health-score-value"></div>
                                <div class="skeleton skeleton-line skeleton-health-score-bar"></div>
                            </div>
                        </div>
                        <div class="skeleton-health-metrics">
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                            <div class="skeleton-health-metric">
                                <div class="skeleton skeleton-line skeleton-metric-label"></div>
                                <div class="skeleton skeleton-line skeleton-metric-value"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="relay-health-list" class="relay-health-grid">
                    <p class="hint">Loading relay health data...</p>
                </div>
            </div>

            <div class="panel chart-panel-full">
                <h3>Health Score History</h3>
                <div class="chart-container-full">
                    <canvas id="health-score-chart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Container -->
    <div id="modal-overlay" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal" role="document">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title"></h2>
                <button class="modal-close" aria-label="Close modal" title="Close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <script src="/static/app.js"></script>
</body>
</html>
